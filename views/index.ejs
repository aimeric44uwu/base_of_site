<html>
<head>
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="script/jquery.js"></script>

</head>
<body class="navbarbody">
  
<div class="notlogin" id="notloggedalert" style="display: none;">
  <h2 class="notlogintext">Vous ne pouvez pas faire ceci, vous n'êtes pas connecté mais vous pouvez vous connecter en cliquant</h2>
  <a href="/login">
  <div class="alertbutton raised green">
      <div class="center"fit>ICI</div>
    </div>
  </a>  
  </div>



<nav >
    <div class="container">

      <ul class="navbar-left">
          
            <% if(logged) { %>
                <li><a >bonjour <%=name%></a></li>
                <li><a href="/profile">mon compte</a></li>
            <%}else{%>
                
               
                <li><a href="/login">se connecter</a></li>
                <li><a href="/register">s'inscrire</a></li>

        <%}%>
      </ul> <!--end navbar-left -->
  
      <ul class="navbar-right">
        <li><a id="cart"><i class="fa fa-shopping-cart"></i> Cart  
                   
            <span class="badge" id="numberofarticlenavbar"></span>
        </a></li>
      </ul> <!--end navbar-right -->
    </div> <!--end container -->
  </nav>
  
  

        
        



      <% if(logged) { %>
        <div class="container">
          <div class="shopping-cart" style="display: none;">
            <div class="shopping-cart-header">
              <i class="fa fa-shopping-cart cart-icon"></i>


          <span class="badge" id="numberofarticle">0</span>

        <div class="shopping-cart-total">
          <span class="lighter-text">Total:</span>
          
            <span class="main-color-text" id="totalpricedisplay"> €</span>

        </div>
      </div> 
          <ul class="shopping-cart-items" id="articleelement">


        </ul>
        <script>
          function updatecart(){
            document.getElementById("totalpricedisplay").innerHTML= 0 + " €"

          $.ajax({
            type: "GET",
            url: "/api/Cartitem",
            dataType: "json",
            processData: false,
            success: function(response) {
              
              var element = document.getElementById("articleelement");
              var numberofarticle = 0;
              var totalprice = 0;
              element.innerHTML = ""

              for(var eacharticle=0; eacharticle < Object.keys(response).length; eacharticle++) { 
                totalprice += response[eacharticle].price
                numberofarticle++
                let articlehtml = ` 
                <li class="clearfix">
              <img src="img/${response[eacharticle].img}" alt="item1" style="max-width: 60px;max-width: 60px;" />
              <span class="item-name">${response[eacharticle].name}</span>
              <span class="item-price">${response[eacharticle].price} €</span>
              
              <span class="item-quantity">quantité: ${response[eacharticle].quantity} ml</span>
            </li>              `
            element.innerHTML += articlehtml;

              }
              if(!totalprice) totalprice = 0
              if(numberofarticle > 0) {
                document.getElementById("confirmbutton").style.display = "";
              }

              document.getElementById("totalpricedisplay").innerHTML= totalprice + " €"
              document.getElementById("numberofarticle").innerHTML = numberofarticle
              document.getElementById("numberofarticlenavbar").innerHTML = numberofarticle 

            }
          })
        }
        updatecart()
        </script>


<a href="#" class="button" id="confirmbutton" style="display: none;">voir mon panier</a>







    </div> 
  </div>
      <%}else{%>
        <div class="container">
          <div class="shopping-cart" style="display: none;">
            <div class="shopping-cart-header">
              <i class="fa fa-shopping-cart cart-icon"></i>

                    
                   
                    <span class="badge">0</span>
    
    
        <div class="shopping-cart-total">
          <span class="lighter-text">Total:</span>
            <span class="main-color-text">0 €</span>

        </div>
      </div> 
        <span class="main-color-text">connectez vous pour pouvoir accéder à votre panier en cliquant <a href="/login" style="color: white;">ici</a></span>

      </div> 
    </div> 
        <%}%>
 





        <div class="wrapper" style="padding-top: 270px">
          <input class="search" type="text" id="search" name="searchedelement" />
          <input class="submitbigbutton" type="submitbigbutton" id="submitbigbutton" value=" " />
        </div>

  <div class="container">
    <div class="row" id="productelement">


    <script>
          function updateproduct(responseproduct){

            document.getElementById("productelement").innerHTML = ""
              for(var i=0; i < Object.keys(responseproduct).length; i++) {
                let articlehtml = `
                <form id="${responseproduct[i][0].name}form">
<div class="col">
  <div class="card">
<img class="card-img-top" src="img/${responseproduct[i][0].img}" alt="Card image cap">
<div class="card-block">
<h4 class="card-title">${responseproduct[i][0].name}</h4>
<input type="hidden" name="productId" value="${responseproduct[i][0].id}">
<input type="hidden" name="name" value="${responseproduct[i][0].name}">

<p class="card-text" id="${responseproduct[i][0].name}unit">Price: ${responseproduct[i][0].priceatml * 5} €</p>
<p class="card-text">${responseproduct[i][0].description}</p>
<select class="soflow-color" name="quantity" id="${responseproduct[i][0].name}quantityselected" onchange="${responseproduct[i][0].name}()" >



</select> 
<a onclick="${responseproduct[i][0].name}basket()" data-name="${responseproduct[i][0].name}" class="add-to-cart btn btn-primary">ajouter au panier</a>
</div>
</div>
</div>
  </form>
`



            let myScript = document.createElement("script");
              myScript.innerText = `function ${responseproduct[i][0].name}() {var newprice = document.getElementById('${responseproduct[i][0].name}quantityselected').selectedOptions[0].value * ${responseproduct[i][0].priceatml};document.getElementById("${responseproduct[i][0].name}unit").innerHTML = "Price: " + newprice  + "€"}function ${responseproduct[i][0].name}basket() {$.ajax({type: 'POST',url: '/',data: $("#${responseproduct[i][0].name}form").serialize(),dataType: "json",success: (response) => {setTimeout(() => {document.getElementById("notloggedalert").style.display = "none";}, 3000);if (response.status == "unlogged") {document.getElementById("notloggedalert").style.display = "";};},error: () => {}});updatecart()};`
                document.getElementById("productelement").innerHTML += articlehtml
                for(var y=0; y < responseproduct[i][0].quantityavaliable.length ; y++) {
                  document.getElementById(`${responseproduct[i][0].name}quantityselected`).innerHTML += `<option value="${responseproduct[i][0].quantityavaliable[y].quantity}">${responseproduct[i][0].quantityavaliable[y].quantity} ml</option>`
                }
                  document.getElementById("productelement").appendChild(myScript)


              }              

            }
        
            $.ajax({
            type: "GET",
            url: "/api/productitem",
            dataType: "json",
            processData: false,
            success: function(rsp) {
              updateproduct(rsp)
            }
          })
 
    </script>

    </div>
</div>

  



  <script src="js/index.js"></script>

  <script>
    ////////////////////////////
// Twitter: @mikedevelops
////////////////////////////

var input = document.getElementById("search");

input.addEventListener("keyup", function(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
    document.getElementById("submitbigbutton").click();
  }
});



var ph = "cherchez des gouts ex: \"cerise\"",
searchBar = $('#search'),
// placeholder loop counter
phCount = 0;

// function to return random number between
// with min/max range
function randDelay(min, max) {
return Math.floor(Math.random() * (max-min+1)+min);
}

// function to print placeholder text in a 
// 'typing' effect
function printLetter(string, el) {
// split string into character seperated array
var arr = string.split(''),
input = el,
// store full placeholder
origString = string,
// get current placeholder value
curPlace = $(input).attr("placeholder"),
// append next letter to current placeholder
placeholder = curPlace + arr[phCount];

setTimeout(function(){
// print placeholder text
$(input).attr("placeholder", placeholder);
// increase loop count
phCount++;
// run loop until placeholder is fully printed
if (phCount < arr.length) {
printLetter(origString, input);
}
// use random speed to simulate
// 'human' typing
}, randDelay(50, 90));
}  

// function to init animation
function placeholder() {
$(searchBar).attr("placeholder", "");
printLetter(ph, searchBar);
}

placeholder();
$('.submitbigbutton').click(function(e){
phCount = 0;
e.preventDefault();
placeholder();
event.preventDefault();
        
$.ajax({
  type: 'POST',
  url: '/api/productitem',
  data: $('#search').serialize(),
  dataType: "json",
  success: (srchitem) => {
    updateproduct(srchitem)

  }
})
document.getElementById("search").value = ""
    
});
  </script>


  <script>
    (function(){

$("#cart").on("click", function() {
 $(".shopping-cart").fadeToggle( "fast");
});

})();
  </script>
</body>
</html>
